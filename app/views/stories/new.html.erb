<% content_for :sideyard do %>

	<div id="prompt_and_timer" style="display:none;">
		<div id="prompt_container" class="prompt_container" >
			<div id="timer_container" class="orange button_container">
				<span id="timer_element">
				</span>
				<!-- the timer is held in the application.js -->
			</div>
			<%= show_prompt %>
			
		</div>

	</div><!-- Prompt and Timer container -->
	<div id="instructions">
	<h2>
		Options
	</h2>
		<p><%= link_to "Write using another prompt", past_prompts_url %></p>
		
	<h2>
		Instructions
	</h2>
	<ol>
		<li>When you click in the writing box, you get a <em>prompt</em>.</li>
		<li>Then you have <strong>six minutes</strong> to write a <em>story</em>.</li>
		<li>Go!</li>
	</ol>
	<p>	
		When the timer stops, <em>you won't be able to type anymore</em>, so use the last seconds <strong>wisely</strong>. 
	</p>
	<p>	
		<em>Before submitting</em> choose a <strong>title</strong>, relevant <strong>tags</strong> and a <strong>license</strong> for your story.
	</p>
</div>
<% end %>
<%= javascript_include_tag "prototype", "effects", :cache => true %>







<div id="new_story_form">
<% form_for(@story) do |f| %>

	<!-- Include the prompt so we can use it on the next page. Is this really necessary? Isn't it in the scope? -->
	<%= hidden_field_tag :prompt, @prompt.id %>

<% unless f.error_messages.empty? %>
	<!-- ERROOOOOOOooooOOORSSSSSSSSSSSSSSSSS -->
<h1>Errors</h1>
<div id="errorExplanation">
	<h2>Your story hasn't been saved yet.</h2>
	<h3>Please check for errors below.</h3>
</div>
<% end %>


			<%= f.error_message_on 'description' %>
			
		
			<% if @story.description.present? || @editing.present?
				 @description = @story.description
				
				if @editing.present? 
					@disabled = true 
				end
			%>	
				<script type="text/javascript">
					window.onload=function(){
						document.getElementById('story_description').disabled=true;
					}
				</script>
				
			<% 
				else
					@disabled = false
					@description = "when you click here \nthe prompt will appear \nand the timer will start"
			
				end
			%>
					
			<%= f.text_area :description, :value => @description, :rows => 12, :cols => 45, :tabindex => "1", :onFocus => "Effect.Appear('prompt_and_timer',{duration:0.1});Effect.Fade('instructions',{duration:0.1});getSetWrite(this);" %>
</div>

<div class="clear space">
</div>

<h1>Details, details, details</h1>

	<table>
		
		<tr>
			
			<td>
				<label for="story_title">Title</label>
			</td>
			
			<td>	
		  		<%= f.text_field :title, :disabled => @disabled, :onFocus => 'clearFieldFirstTime(this);', :value => @title, :tabindex => "2" %>
			</td>
		</tr>
		<tr>
			<td colspan=2>
				&nbsp; <%= f.error_message_on 'title' %>
			</td>
		
		</tr>
		<tr>	
			<td>
				<label for="story_tags">Adjectives</label><br />
				<span style="font-size:x-small">separate adjectives with commas</span>
			</td>
			<td>	
					<% if @story.tags.present? -%>
						<% @story.tags.each do |tag| -%>
			   				<%= tag %>
						<% end -%>
					<% end -%>
						
		 			<%= f.text_field :tag_list, :onFocus => 'clearFieldFirstTime(this);', :value => @tags, :tabindex => "3" %>
				
	  		</td>
		</tr>
		<tr>
			<td colspan=2>
				&nbsp; 	<%= f.error_message_on 'license' %>
			</td>
		</tr>
		<tr>
			<td>
				<label for="story_license">License</label>
			</td>
			<td>
				
				<select name="story[license]" id="story_license" onchange="" tabindex="4">
					<option value="Creative Commons Attribution 3.0">
						Creative Commons Attribution 3.0</option>
			
					<option value="Creative Commons Attribution-NoDerivs 3.0">
						Creative Commons Attribution-NoDerivs 3.0</option>
						
					<option value="Creative Commons Attribution-NonCommerical-NoDerivs 3.0">
						Creative Commons Attribution-NonCommercial-NoDerivs 3.0</option>
			
					<option value="Creative Commons AttributionNonCommerical 3.0">
						Creative Commons Attribution-NonCommercial 3.0</option>
			
					<option value="Creative Commons Attribution-NonCommerical-ShareAlike 3.0">
						Creative Commons Attribution-NonCommercial-ShareAlike 3.0</option>
			
					<option value="Creative Commons Attribution-ShareAlike 3.0" selected="selected">
						Creative Commons Attribution-ShareAlike 3.0</option>
					<option value="Public Domain">Public Domain</option>
					
				</select>
			</td>
		</tr>
	</table>
	
	<div class="clear space">
	</div>
<h1>Prove you're human</h1>
		<div class="center">
			<p>
					<% unless @editing.present? %>
						<% if session[:recaptcha_error].present? %>
						 	<span class="formError">Incorrect text entered.</span>
						<% end %>

						<%= recaptcha_tags :display => {:tabindex => "5"} %>
					<% end %>

				
			</p>
			<br />
				<p>
				<%= image_submit_tag("save.png", :name => "save", :id => "save-button", :tabindex => "6", :onclick => "document.getElementById('story_description').disabled=false;") %>
				 <% if current_user.id == @story.user_id %>
						<%= link_to 'Destroy story', @story, :confirm => 'Are you sure you want to remove this story? Your story will no longer be visible!', :method => :delete %>
						<% end %>
				</p>

<% end %>
</div>

